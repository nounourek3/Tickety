<div class="panel-container container mt-4">

  <!-- üî¢ KPIs -->
  <div class="row mb-4 text-center">
    <div class="col-md-4">
      <div class="kpi-box p-3 rounded shadow-sm bg-white">
        <h6 class="text-muted">Pa√≠ses visitados</h6>
        <h2>{{ visitedCountries.length }}</h2>
      </div>
    </div>
    <div class="col-md-4">
      <div class="kpi-box p-3 rounded shadow-sm bg-white" (click)="abrirModalWishlist()">
        <h6 class="text-muted">Wishlist</h6>
        <h2>{{ wishlistCountries.length }}</h2>
      </div>
    </div>
    <div class="col-md-4">
      <div class="kpi-box p-3 rounded shadow-sm bg-white">
        <h6 class="text-muted">% del mundo visitado</h6>
        <h2>{{ percentVisited }}%</h2>
      </div>
    </div>
  </div>

  <!-- üìã Main content -->
  <div class="row g-4">
    <!-- üß≠ Left section -->
    <div class="col-md-8 d-flex flex-column gap-3">

      <!-- üåê Mis viajes y mapa -->
      <div class="d-flex flex-column flex-md-row gap-3">
        <!-- Lista de viajes -->
        <div class="flex-fill p-3 rounded shadow-sm bg-white border" style="min-height: 280px;">
          <h5 class="mb-3">Mis viajes</h5>
          <div *ngIf="visitedCountries.length > 0; else noCountries">
            <div *ngFor="let country of visitedCountries" class="d-flex align-items-center mb-2">
              <img [src]="'https://flagcdn.com/24x18/' + country.toLowerCase() + '.png'" class="me-2 rounded" />
              <span>{{ countryNameMap[country] || country }}</span>
            </div>
          </div>
          <ng-template #noCountries>
            <p class="text-muted">No se han registrado pa√≠ses a√∫n.</p>
          </ng-template>
        </div>

        <!-- Mapa -->
        <div class="flex-fill d-flex flex-column gap-2">
          <div class="rounded shadow-sm border bg-white" style="height: 280px;">
            <div id="map" style="width: 100%; height: 100%; border-radius: 0.5rem;"></div>
          </div>
          <div class="p-3 rounded shadow-sm bg-white border">
            <h6><i class="bi bi-map-fill me-2"></i>Leyenda</h6>
            <ul class="list-unstyled mb-0">
              <li><span class="legend-box bg-danger me-2"></span> Pa√≠ses visitados</li>
              <li><span class="legend-box bg-primary me-2"></span> Pr√≥ximos vuelos</li>
              <li><span class="legend-box bg-warning me-2"></span> Wishlist</li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- üìÜ Right section -->
    <div class="col-md-4 d-flex flex-column gap-3">
      <!-- Calendario -->
      <div class="calendar-box p-3 rounded shadow-sm bg-white border">
        <full-calendar [options]="calendarOptions"></full-calendar>
      </div>

      <!-- Pr√≥ximos vuelos -->
      <div class="upcoming-bookings p-3 rounded shadow-sm bg-white border">
        <h6>Pr√≥ximos vuelos</h6>
        <div *ngIf="upcomingFlights.length > 0; else noFlights">
          <div *ngFor="let vuelo of upcomingFlights" class="booking-card border rounded p-2 d-flex align-items-center justify-content-between mb-2">
            <div>
              <strong>{{ vuelo.departureAirport }} ‚Üí {{ vuelo.arrivalAirport }}</strong><br />
              <small>{{ vuelo.flightDate | date:'shortDate' }}</small>
            </div>
            <div class="text-end">
              <small class="text-muted">Duraci√≥n</small><br />
              <strong>{{ vuelo.durationHours }}h</strong>
            </div>
          </div>
        </div>
        <ng-template #noFlights>
          <p class="text-muted">No hay vuelos pr√≥ximos.</p>
        </ng-template>
      </div>
    </div>
  </div>

  <!-- ‚≠ê Wishlist Modal -->
  <div class="modal-backdrop" *ngIf="wishlistAbierto">
    <div class="modal-content">
      <h5>üåü Lugares que quieres visitar</h5>
      <ul class="list-group mb-3">
        <li *ngFor="let lugar of wishlistCountries; let i = index" class="list-group-item d-flex justify-content-between align-items-center">
          {{ lugar }}
          <button class="btn btn-sm btn-danger" (click)="eliminarDeWishlist(i)">
            <i class="bi bi-trash"></i>
          </button>
        </li>
      </ul>

      <div class="input-group">
        <input [(ngModel)]="nuevoDestino" class="form-control" placeholder="Ej. Jap√≥n, Islandia, Nueva York" />
        <button class="btn btn-primary" (click)="addToWishlist()">
          <i class="bi bi-plus-lg"></i> A√±adir
        </button>
      </div>

      <button class="btn btn-secondary mt-3" (click)="cerrarModalWishlist()">Cerrar</button>
    </div>
  </div>
</div>
